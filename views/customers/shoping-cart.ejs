<%- include('../layouts/header.ejs') %>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Humberger Begin -->
   
    <!-- Humberger End -->

    <!-- Header Section Begin -->
    <%- include('../layouts/nav.ejs') %>
    <!-- Header Section End -->

    <!-- Hero Section Begin -->
    <section class="hero hero-normal">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="hero__categories">
                        
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="hero__search">
                        <div class="hero__search__form">
                            <form action="#">
                                <div class="hero__search__categories">
                                    All Categories
                                    <span class="arrow_carrot-down"></span>
                                </div>
                                <input type="text" placeholder="What do yo u need?">
                                <button type="submit" class="site-btn">SEARCH</button>
                            </form>
                        </div>
                        <div class="hero__search__phone">
                            <div class="hero__search__phone__icon">
                                <i class="fa fa-phone"></i>
                            </div>
                            <div class="hero__search__phone__text">
                                <h5>+65 11.188.888</h5>
                                <span>support 24/7 time</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section set-bg" data-setbg="img/breadcrumb.jpg">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>Shopping Cart</h2>
                        <div class="breadcrumb__option">
                            <a href="./index.html">Home</a>
                            <span>Shopping Cart</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Shoping Cart Section Begin -->
    <section class="shoping-cart spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="shoping__cart__table">
                        <% if (cartData != null && cartData.products.length !== 0) { %>
                        <table>
                            <thead>
                                <tr>
                                    <th class="shoping__product">Products</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th>Remove</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                    
                                <tr> <% if (cartData != null && cartData.products.length !== 0) { 
                                    for(let i=0;i<product.length;i++) { %>
                                    <td class="shoping__cart__item">
                                        <img style="height:5rem;width:5rem;" src="/productimage/<%= cartData.products[i].item.Image[0] %>" alt="<%= cartData.products[i].item.Image[0] %>">
                                        <h5><%= cartData.products[i].item.name %></h5>
                                    </td>
                                    <td class="shoping__cart__price">
                                        Rs.<%= cartData.products[i].item.price %>
                                    </td>
                                    <td class="shoping__cart__quantity">
                                        <div class="quantity">
                                            <div class="pro-qty">
                                               
                                                
                                                <span class="dec qtybtn" onclick="decrement('<%= cartData.products[i].item._id %>')">-</span>
                                                <input type="text" value="<%= cartData.products[i].quantity %>" id="<%= cartData.products[i].quantity%>" name="quantity" >
                                                <span class="inc qtybtn" onclick="increment('<%= cartData.products[i].item._id %>')">+</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="cart__total" id="total-<%= cartData.products[i].item._id %>">
                                        <%= cartData.products[i].pricetotal %>
                                        
                              
                                    
                                     

                                    </td>
                                    <td class="shoping__cart__close">
                                        <div style="    height: 37px;
                                        width: 240px;"><a href="/delete-item?id=<%= cartData.products[i].item._id %>" ><span ><i class="bi bi-trash" style="color: red; margin-bottom: 10px;"></i></span></a></div>
                                    </td>
                                </tr>
                            
                             
                            </tbody>
                            <% } %>
							<% } else {%>
							  <tr>
								<td colspan="5">Cart is empty</td>
		  
							  </tr>
							 <% } %>
                                
                        </table>
                       
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="shoping__cart__btns">
                        <a href="/shop" class="primary-btn cart-btn">CONTINUE SHOPPING</a>
                        <a href="/cart" class="primary-btn cart-btn cart-btn-right"><span class="icon_loading"></span>
                            Upadate Cart</a>
                    </div>
                </div>
               
                <div class="col-lg-6">
                    
                </div>
                <div class="col-lg-6">
                    <% if (cartData != null || !cartProducts.length === 0 ) { %>
                    <div class="shoping__checkout">
                        <h5>Cart Total</h5>
                        <ul>
                            <li>Subtotal <span id="total-price">&#X20B9;
                                <% let prices=0; %>
                                <% for(let j=0;j<product.length;j++) { %>
                                    <% prices +=cartItem[j].pricetotal; %>
                                        <% } %><%=  prices %></span> </li>
                            <li>Total <span id="total-order">&#X20B9;
                                <% let price=0; %>
                                <% for(let j=0;j<product.length;j++) { %>
                                    <% price +=cartItem[j].pricetotal; %>
                                        <% } %><%=  price %>
                               
                            </span></li>
                        </ul>
                        <a href="/checkout" class="primary-btn">PROCEED TO CHECKOUT</a>
                    </div>
                </div>
                <% } else {  %>

                   
                    <% } %>
            </div>
            <% } else {  %>
                <div class="container-fluid  mt-100">
                   
                           <div class="card-body cart">
                                   <div class="col-sm-12 empty-cart-cls text-center">
                                       <img src="https://i.imgur.com/dCdflKN.png" width="130" height="130" class="img-fluid mb-4 mr-3">
                                       <h3><strong>Your Cart is Empty</strong></h3>
                                       <h4>Add something to make me happy :)</h4>
                                       <a href="/shop" class="btn  cart-btn-transform m-3" style="background-color:#7fad39 ; color: azure;"  data-abc="true">continue shopping</a>
                                       
                                   
                                   </div>
                           </div>
                   </div>
                           
                       
                       </div>
                    
                    </div>
                   
                   </div>

                <% } %>
        </div>
    </section>
    <!-- Shoping Cart Section End -->

    <!-- price increment using ajax -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function increment(productId){
         
            $.ajax({
                url:`cart/${productId}`,
                method:'post',
                success:function(response){
                     if(response.success == "success"){
                    
                    document.getElementById(`total-${productId}`).textContent = response.updatedPrice
                     document.getElementById('total-price').textContent = response.sum
                     document.getElementById('total-order').textContent = response.sum
                     }
                     else if(response.success == "failed"){
                        const Toast = Swal.mixin({
                                toast: true,
                                position: 'top',
                                showConfirmButton: false,
                                timer: 2000,
                                timerProgressBar: true,
                                didOpen: (toast) => {
                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                }
                                })

                                Toast.fire({
                                icon: 'error',
                                title: 'out of stock'
                                })
                     }
    
        
                 
                
                }
            }
            )

        }
            
            </script>

<script>
    function decrement(productId){
               
    $.ajax({
    url:`cart/${productId}`,
    method:'get',
    success: function(response){
    document.getElementById(`total-${productId}`).textContent = response.updatedPrice
    document.getElementById('total-price').textContent = response.sum
    document.getElementById('total-order').textContent = response.sum
}
})


}     
    //     alert("out of stock")

               

          
           

// const qty = document.getElementById(productId)
// const currentQty = qty.value

// if (currentQty > 1) {

</script>
  
        

















































            
        

     
    </script>
   


    <!-- Footer Section Begin -->
    
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <%- include('../layouts/footer.ejs') %>